{% extends 'base.html' %}

{% block content %}
<!-- الملخص السريع - Quick Summary -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="dashboard-welcome shadow-sm bg-light rounded p-4 mb-4 position-relative overflow-hidden">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="fw-bold text-primary"><i class="fas fa-tachometer-alt me-2"></i> مرحباً، {{ session.username }}!</h2>
                    <p class="lead mb-0">
                        {% if forwarding_active %}
                        <span class="badge bg-success me-2"><i class="fas fa-check-circle me-1"></i> التوجيه نشط</span>
                        {% else %}
                        <span class="badge bg-danger me-2"><i class="fas fa-times-circle me-1"></i> التوجيه متوقف</span>
                        {% endif %}
                        آخر تحديث: <span class="text-primary">{% if stats.last_forwarded %}{{ stats.last_forwarded.strftime('%Y-%m-%d %H:%M:%S') }}{% else %}لم يتم التوجيه بعد{% endif %}</span>
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <button class="btn {% if forwarding_active %}btn-danger{% else %}btn-success{% endif %} me-2">
                        <i class="fas {% if forwarding_active %}fa-stop-circle{% else %}fa-play-circle{% endif %} me-1"></i>
                        {% if forwarding_active %}إيقاف التوجيه{% else %}تشغيل التوجيه{% endif %}
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-sync-alt me-1"></i> تحديث
                    </button>
                </div>
            </div>
            <div class="decorative-icon">
                <i class="fab fa-telegram-plane text-primary-light"></i>
            </div>
        </div>
    </div>
</div>

<!-- الإحصائيات الرئيسية - Main Stats -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow border-0">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i> أداء البوت
                    </h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-light active">اليوم</button>
                        <button type="button" class="btn btn-sm btn-outline-light">الأسبوع</button>
                        <button type="button" class="btn btn-sm btn-outline-light">الشهر</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="card bg-gradient-primary text-white stat-card shadow-sm border-0 rounded-4 position-relative overflow-hidden">
                            <div class="stat-icon-bg"><i class="fas fa-exchange-alt"></i></div>
                            <div class="stat-content">
                                <div class="stat-number">{{ stats.messages_forwarded }}</div>
                                <div class="stat-label">رسائل تم توجيهها</div>
                                <div class="stat-change positive">+{{ stats.messages_forwarded // 10 }} اليوم</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-gradient-success text-white stat-card shadow-sm border-0 rounded-4 position-relative overflow-hidden">
                            <div class="stat-icon-bg"><i class="fas fa-calendar-alt"></i></div>
                            <div class="stat-content">
                                <div class="stat-number">{{ stats.started_at.strftime('%Y-%m-%d') }}</div>
                                <div class="stat-label">تاريخ بدء التشغيل</div>
                                <div class="stat-change">{{ (stats.started_at.date() - stats.started_at.date()).days }} يوم من التشغيل</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-gradient-info text-white stat-card shadow-sm border-0 rounded-4 position-relative overflow-hidden">
                            <div class="stat-icon-bg"><i class="fas fa-clock"></i></div>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% if stats.last_forwarded %}
                                        {{ stats.last_forwarded.strftime('%H:%M:%S') }}
                                    {% else %}
                                        لا يوجد
                                    {% endif %}
                                </div>
                                <div class="stat-label">آخر توجيه</div>
                                <div class="stat-change">
                                    {% if stats.last_forwarded %}
                                        منذ {{ 24 }} ساعة
                                    {% else %}
                                        -
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-gradient-danger text-white stat-card shadow-sm border-0 rounded-4 position-relative overflow-hidden">
                            <div class="stat-icon-bg"><i class="fas fa-exclamation-triangle"></i></div>
                            <div class="stat-content">
                                <div class="stat-number">{{ stats.errors }}</div>
                                <div class="stat-label">أخطاء</div>
                                <div class="stat-change negative">+{{ stats.errors // 5 }} هذا الأسبوع</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- مخطط أداء البوت - Statistics & Charts -->
                <div class="performance-chart mt-4">
                    <div class="stats-charts">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-white">
                                        <h6 class="mb-0 fw-bold text-primary">
                                            <i class="fas fa-chart-line me-2"></i>
                                            إحصائيات توجيه الرسائل
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="messagesChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-header bg-white">
                                        <h6 class="mb-0 fw-bold text-primary">
                                            <i class="fas fa-chart-pie me-2"></i>
                                            توزيع أنواع الوسائط
                                        </h6>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="mediaTypesChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- تفاصيل إحصائية إضافية -->
                        <div class="detailed-stats bg-white rounded-4 shadow-sm p-4">
                            <div class="stats-header mb-4">
                                <h5 class="fw-bold text-primary">
                                    <i class="fas fa-analytics me-2"></i>
                                    الإحصائيات التفصيلية
                                </h5>
                                <div class="stats-timestamp text-muted small">
                                    <i class="fas fa-sync-alt me-1"></i>
                                    آخر تحديث: <span class="fw-bold">{{ stats.last_updated.strftime('%Y-%m-%d %H:%M:%S') if stats.last_updated else 'الآن' }}</span>
                                </div>
                            </div>
                            
                            <div class="row g-4">
                                <!-- عمود 1: إحصائيات الرسائل -->
                                <div class="col-md-6">
                                    <div class="stat-group mb-3">
                                        <h6 class="stat-group-title fw-bold">
                                            <i class="fas fa-envelope me-2"></i>
                                            إحصائيات الرسائل
                                        </h6>
                                        <div class="stat-list">
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>إجمالي الرسائل المستلمة:</span>
                                                <span class="fw-bold text-primary">{{ stats.messages_received }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>إجمالي الرسائل الموجهة:</span>
                                                <span class="fw-bold text-success">{{ stats.messages_forwarded }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>الرسائل المرفوضة:</span>
                                                <span class="fw-bold text-danger">{{ stats.messages_filtered }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2">
                                                <span>معدل نجاح التوجيه:</span>
                                                <span class="fw-bold text-info">{{ (stats.messages_forwarded / stats.messages_received * 100)|round(1) if stats.messages_received > 0 else 0 }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-group">
                                        <h6 class="stat-group-title fw-bold">
                                            <i class="fas fa-filter me-2"></i>
                                            أسباب الفلترة
                                        </h6>
                                        <div class="stat-list">
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>كلمات محظورة:</span>
                                                <span class="fw-bold">{{ stats.filtered_by_blacklist }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>رسائل مكررة:</span>
                                                <span class="fw-bold">{{ stats.filtered_duplicates }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>لغة غير مدعومة:</span>
                                                <span class="fw-bold">{{ stats.filtered_by_language }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2">
                                                <span>روابط محظورة:</span>
                                                <span class="fw-bold">{{ stats.filtered_links }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- عمود 2: إحصائيات الوسائط -->
                                <div class="col-md-6">
                                    <div class="stat-group mb-3">
                                        <h6 class="stat-group-title fw-bold">
                                            <i class="fas fa-photo-video me-2"></i>
                                            أنواع الوسائط
                                        </h6>
                                        <div class="stat-list">
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>
                                                    <i class="fas fa-font text-primary me-1"></i>
                                                    نصوص:
                                                </span>
                                                <span class="fw-bold">{{ stats.text_messages }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>
                                                    <i class="fas fa-image text-success me-1"></i>
                                                    صور:
                                                </span>
                                                <span class="fw-bold">{{ stats.image_messages }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>
                                                    <i class="fas fa-video text-danger me-1"></i>
                                                    فيديوهات:
                                                </span>
                                                <span class="fw-bold">{{ stats.video_messages }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2">
                                                <span>
                                                    <i class="fas fa-file text-info me-1"></i>
                                                    ملفات وأخرى:
                                                </span>
                                                <span class="fw-bold">{{ stats.other_messages }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-group">
                                        <h6 class="stat-group-title fw-bold">
                                            <i class="fas fa-clock me-2"></i>
                                            إحصائيات الوقت
                                        </h6>
                                        <div class="stat-list">
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>فترة التشغيل:</span>
                                                <span class="fw-bold">{{ stats.uptime }} يوم</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>معدل الرسائل اليومي:</span>
                                                <span class="fw-bold">{{ stats.daily_average }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2 border-bottom">
                                                <span>وقت ذروة النشاط:</span>
                                                <span class="fw-bold">{{ stats.peak_time }}</span>
                                            </div>
                                            <div class="stat-item d-flex justify-content-between p-2">
                                                <span>معدل الاستجابة:</span>
                                                <span class="fw-bold">{{ stats.response_time }} ثانية</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- الصف الثاني - القنوات والفلاتر -->
<div class="row">
    <div class="col-lg-6">
        <!-- إعدادات القنوات -->
        <div class="card shadow mb-4 border-0">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-exchange-alt me-2"></i> القنوات وإعدادات التوجيه
                    </h5>
                    <a href="{{ url_for('settings') }}" class="btn btn-sm btn-light">
                        <i class="fas fa-edit me-1"></i> تعديل
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="channels-overview">
                    <div class="channel-flow d-flex align-items-center mb-4">
                        <div class="channel-card source flex-fill p-3 bg-light rounded text-center">
                            <i class="fas fa-broadcast-tower fa-2x text-primary mb-2"></i>
                            <h5>القناة المصدر</h5>
                            <div class="badge bg-primary rounded-pill fs-6 p-2">{{ source_channel }}</div>
                        </div>
                        <div class="flow-arrow px-3">
                            <i class="fas fa-long-arrow-alt-left fa-2x text-primary"></i>
                        </div>
                        <div class="channel-card target flex-fill p-3 bg-light rounded text-center">
                            <i class="fas fa-bullseye fa-2x text-primary mb-2"></i>
                            <h5>القناة الهدف</h5>
                            <div class="badge bg-primary rounded-pill fs-6 p-2">{{ target_channel }}</div>
                        </div>
                    </div>
                    
                    <div class="config-details p-3 bg-light rounded">
                        <h6 class="fw-bold"><i class="fas fa-cogs me-2"></i>تفاصيل التكوين</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="config-item mb-2">
                                    <span class="text-muted">وضع التوجيه:</span>
                                    <span class="fw-bold">
                                        {% if forward_mode == 'copy' %}
                                        <i class="fas fa-copy text-info me-1"></i> نسخ
                                        {% else %}
                                        <i class="fas fa-share text-info me-1"></i> توجيه
                                        {% endif %}
                                    </span>
                                </div>
                                <div class="config-item mb-2">
                                    <span class="text-muted">حالة التوجيه:</span>
                                    <span class="fw-bold">
                                        {% if forwarding_active %}
                                        <i class="fas fa-check-circle text-success me-1"></i> نشط
                                        {% else %}
                                        <i class="fas fa-times-circle text-danger me-1"></i> متوقف
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="config-item mb-2">
                                    <span class="text-muted">فلاتر نشطة:</span>
                                    <span class="fw-bold">5 فلاتر</span>
                                </div>
                                <div class="config-item mb-2">
                                    <span class="text-muted">الفترة الزمنية:</span>
                                    <span class="fw-bold">24/7</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- أحدث التحديثات -->
        <div class="card shadow mb-4 border-0">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bell me-2"></i> أحدث التحديثات
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1"><i class="fas fa-check-circle text-success me-1"></i> تم توجيه 50 رسالة بنجاح</h6>
                            <small class="text-muted">منذ 2 ساعة</small>
                        </div>
                        <small class="text-muted">تم توجيه مجموعة من الرسائل النصية والصور</small>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1"><i class="fas fa-filter text-primary me-1"></i> تم تحديث إعدادات الفلاتر</h6>
                            <small class="text-muted">منذ 5 ساعات</small>
                        </div>
                        <small class="text-muted">تم تفعيل فلتر اللغة وإضافة كلمات للقائمة السوداء</small>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1"><i class="fas fa-exclamation-triangle text-danger me-1"></i> تم تسجيل خطأ في التوجيه</h6>
                            <small class="text-muted">منذ 1 يوم</small>
                        </div>
                        <small class="text-muted">فشل في توجيه 3 رسائل بسبب قيود التلجرام</small>
                    </div>
                </div>
                <div class="text-center p-3">
                    <a href="#" class="btn btn-sm btn-outline-primary">عرض جميع التحديثات</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <!-- حالة الفلاتر النشطة -->
        <div class="card shadow mb-4 border-0">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-filter me-2"></i> الفلاتر النشطة
                    </h5>
                    <a href="{{ url_for('settings') }}" class="btn btn-sm btn-light">
                        <i class="fas fa-sliders-h me-1"></i> تعديل الفلاتر
                    </a>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>نوع الفلتر</th>
                                <th>الحالة</th>
                                <th>التفاصيل</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><i class="fas fa-language text-primary me-1"></i> فلتر اللغة</td>
                                <td><span class="badge bg-success">نشط</span></td>
                                <td>اللغة العربية فقط</td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-ban text-primary me-1"></i> فلتر الكلمات</td>
                                <td><span class="badge bg-success">نشط</span></td>
                                <td>5 كلمات محظورة</td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-photo-video text-primary me-1"></i> فلتر الوسائط</td>
                                <td><span class="badge bg-danger">غير نشط</span></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-link text-primary me-1"></i> فلتر الروابط</td>
                                <td><span class="badge bg-success">نشط</span></td>
                                <td>إزالة الأزرار والروابط</td>
                            </tr>
                            <tr>
                                <td><i class="fas fa-clone text-primary me-1"></i> منع التكرار</td>
                                <td><span class="badge bg-success">نشط</span></td>
                                <td>التذكر لمدة 24 ساعة</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- المهام السريعة -->
        <div class="card shadow mb-4 border-0">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-tasks me-2"></i> المهام السريعة
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="{{ url_for('settings') }}" class="card quick-action-card h-100 p-3 bg-light rounded text-decoration-none">
                            <div class="d-flex align-items-center">
                                <div class="quick-action-icon me-3">
                                    <i class="fas fa-cog fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">تكوين القنوات</h6>
                                    <small class="text-muted">تعديل إعدادات المصدر والهدف</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{{ url_for('admins') }}" class="card quick-action-card h-100 p-3 bg-light rounded text-decoration-none">
                            <div class="d-flex align-items-center">
                                <div class="quick-action-icon me-3">
                                    <i class="fas fa-users-cog fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">إدارة المشرفين</h6>
                                    <small class="text-muted">إضافة أو إزالة مشرفين للبوت</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{{ url_for('settings') }}" class="card quick-action-card h-100 p-3 bg-light rounded text-decoration-none">
                            <div class="d-flex align-items-center">
                                <div class="quick-action-icon me-3">
                                    <i class="fas fa-text-height fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">تخصيص النصوص</h6>
                                    <small class="text-muted">إعداد استبدالات النصوص</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{{ url_for('settings') }}" class="card quick-action-card h-100 p-3 bg-light rounded text-decoration-none">
                            <div class="d-flex align-items-center">
                                <div class="quick-action-icon me-3">
                                    <i class="fas fa-language fa-2x text-primary"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-dark">الترجمة التلقائية</h6>
                                    <small class="text-muted">إعداد خيارات الترجمة</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- إضافة بعض التنسيقات CSS المخصصة -->
<style>
.text-primary-light { color: rgba(13, 110, 253, 0.1); }
.bg-gradient-primary { background: linear-gradient(45deg, #0d6efd, #0a58ca); }
.bg-gradient-success { background: linear-gradient(45deg, #198754, #146c43); }
.bg-gradient-info { background: linear-gradient(45deg, #0dcaf0, #0aa2c0); }
.bg-gradient-danger { background: linear-gradient(45deg, #dc3545, #b02a37); }

.dashboard-welcome {
    background: linear-gradient(45deg, #f8f9fa, #ffffff);
    border-left: 4px solid #0d6efd;
}

.decorative-icon {
    position: absolute;
    right: -15px;
    top: -15px;
    font-size: 8rem;
    opacity: 0.1;
    transform: rotate(-15deg);
}

.stat-card {
    padding: 1.5rem;
    border-radius: 0.5rem;
    position: relative;
    overflow: hidden;
    min-height: 140px;
}

.stat-content {
    position: relative;
    z-index: 1;
}

.stat-icon-bg {
    position: absolute;
    right: -15px;
    bottom: -15px;
    font-size: 5rem;
    opacity: 0.2;
}

.stat-number {
    font-size: 1.8rem;
    font-weight: bold;
    margin-bottom: 0.2rem;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0.5rem;
}

.stat-change {
    font-size: 0.8rem;
    opacity: 0.9;
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 1rem;
    padding: 0.2rem 0.6rem;
    display: inline-block;
}

.stat-change.positive::before {
    content: "▲ ";
}

.stat-change.negative::before {
    content: "▼ ";
}

.channel-card, .quick-action-card {
    transition: all 0.3s ease;
}

.channel-card:hover, .quick-action-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.rounded-4 {
    border-radius: 0.75rem !important;
}
</style>
<!-- إضافة Chart.js لإنشاء الرسوم البيانية -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

<script>
// تهيئة الرسوم البيانية عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    // Telegram brand colors
    const brandColors = {
        primary: '#0088cc',
        secondary: '#4fad2f',
        danger: '#d14130',
        warning: '#e09f4a',
        info: '#5899d0',
        dark: '#363861',
        light: '#e1e8ed'
    };
    
    // البيانات الخاصة بإحصائيات توجيه الرسائل
    const messagesCtx = document.getElementById('messagesChart').getContext('2d');
    const messagesChart = new Chart(messagesCtx, {
        type: 'line',
        data: {
            labels: ['اليوم-6', 'اليوم-5', 'اليوم-4', 'اليوم-3', 'اليوم-2', 'اليوم-1', 'اليوم'],
            datasets: [
                {
                    label: 'رسائل مستلمة',
                    data: [65, 78, 52, 91, 43, 89, 75],
                    borderColor: brandColors.primary,
                    backgroundColor: hexToRgba(brandColors.primary, 0.1),
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'رسائل موجهة',
                    data: [59, 69, 45, 80, 35, 80, 70],
                    borderColor: brandColors.secondary,
                    backgroundColor: hexToRgba(brandColors.secondary, 0.1),
                    tension: 0.3,
                    fill: true
                },
                {
                    label: 'رسائل مرفوضة',
                    data: [6, 9, 7, 11, 8, 9, 5],
                    borderColor: brandColors.danger,
                    backgroundColor: hexToRgba(brandColors.danger, 0.1),
                    borderDash: [5, 5],
                    tension: 0.3,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    rtl: true,
                    labels: {
                        usePointStyle: true,
                        pointStyle: 'circle',
                        font: {
                            family: 'Tajawal, Arial, sans-serif'
                        }
                    }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    titleFont: {
                        family: 'Tajawal, Arial, sans-serif'
                    },
                    bodyFont: {
                        family: 'Tajawal, Arial, sans-serif'
                    },
                    rtl: true,
                    textDirection: 'rtl'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        font: {
                            family: 'Tajawal, Arial, sans-serif'
                        }
                    },
                    grid: {
                        drawBorder: false
                    }
                },
                x: {
                    ticks: {
                        font: {
                            family: 'Tajawal, Arial, sans-serif'
                        }
                    },
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    
    // بيانات توزيع أنواع الوسائط
    const mediaTypesCtx = document.getElementById('mediaTypesChart').getContext('2d');
    const mediaTypesChart = new Chart(mediaTypesCtx, {
        type: 'doughnut',
        data: {
            labels: ['نصوص', 'صور', 'فيديوهات', 'ملفات', 'روابط'],
            datasets: [{
                data: [45, 25, 15, 10, 5],
                backgroundColor: [
                    brandColors.primary,
                    brandColors.secondary,
                    brandColors.danger,
                    brandColors.info,
                    brandColors.warning
                ],
                hoverOffset: 4,
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                    rtl: true,
                    labels: {
                        usePointStyle: true,
                        pointStyle: 'circle',
                        padding: 15,
                        font: {
                            family: 'Tajawal, Arial, sans-serif',
                            size: 12
                        }
                    }
                },
                tooltip: {
                    titleFont: {
                        family: 'Tajawal, Arial, sans-serif'
                    },
                    bodyFont: {
                        family: 'Tajawal, Arial, sans-serif'
                    },
                    rtl: true,
                    textDirection: 'rtl'
                }
            }
        }
    });
    
    // تنسيق بطاقات الإحصائيات
    styleStatCards();
    
    // تمكين تأثيرات الحركة عند التمرير
    initScrollAnimations();
});

// وظيفة لتحويل لون HEX إلى RGBA لاستخدامه في الخلفيات الشفافة
function hexToRgba(hex, alpha = 1) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

// إضافة تأثيرات حركية لبطاقات الإحصائيات
function styleStatCards() {
    const statCards = document.querySelectorAll('.stat-card');
    
    statCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.classList.add('stat-card-hover');
        });
        
        card.addEventListener('mouseleave', function() {
            this.classList.remove('stat-card-hover');
        });
    });
}

// تأثيرات الحركة عند التمرير
function initScrollAnimations() {
    const animatedElements = document.querySelectorAll('.detailed-stats, .stat-card');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animated-in');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });
    
    animatedElements.forEach(element => {
        observer.observe(element);
    });
}
</script>

<style>
/* تنسيقات الإحصائيات */
.detailed-stats {
    border: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.detailed-stats:hover {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
}

.stat-group-title {
    color: var(--gray-700);
    padding-bottom: 0.5rem;
    margin-bottom: 0.75rem;
    border-bottom: 2px solid rgba(0, 0, 0, 0.05);
}

.stat-item {
    transition: all 0.3s ease;
    background-color: rgba(0, 0, 0, 0.01);
}

.stat-item:hover {
    background-color: rgba(0, 0, 0, 0.03);
}

/* تنسيقات حركية للبطاقات */
.stat-card {
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    transform: translateY(0);
}

.stat-card-hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

.animated-in {
    animation: fadeInUp 0.6s both;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* تنسيقات مخصصة للرسوم البيانية */
.stat-card {
    overflow: hidden;
}

.stat-icon-bg {
    position: absolute;
    bottom: -20px;
    right: -10px;
    font-size: 5rem;
    opacity: 0.15;
    transform: rotate(-10deg);
}

.stat-content {
    position: relative;
    z-index: 2;
    padding: 1.5rem;
}

.stat-number {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0.5rem;
}

.stat-change {
    font-size: 0.75rem;
    padding: 0.2rem 0.5rem;
    border-radius: 50px;
    display: inline-block;
    background-color: rgba(255, 255, 255, 0.2);
}

.stat-change.positive {
    color: #a5f3c4;
}

.stat-change.negative {
    color: #ffacac;
}

/* خلفيات متدرجة للبطاقات */
.bg-gradient-primary {
    background: linear-gradient(45deg, #0088cc, #00a8ff);
}

.bg-gradient-success {
    background: linear-gradient(45deg, #4fad2f, #6bd655);
}

.bg-gradient-info {
    background: linear-gradient(45deg, #5899d0, #47c0e3);
}

.bg-gradient-danger {
    background: linear-gradient(45deg, #d14130, #ff6a5b);
}

/* منطقة الرسوم البيانية */
.stats-charts {
    opacity: 0;
    animation: fadeIn 1s forwards 0.5s;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>

{% endblock %}